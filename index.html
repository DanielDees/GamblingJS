<!DOCTYPE html>
<html>
<head>
	<title>Casino JS</title>
	<meta charset="utf-8">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">

	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

	<link rel="stylesheet" type="text/css" href="CSS.css">

	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<!-- VUE -->
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	
	<!-- Chart.js -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>

</head>
<body>
	<div id="wrapper">

		<canvas id="graph"></canvas>

		<h1>Casino JS</h1>
		
		<h2 id="round">Round: {{ round }}</h2>

		<h3>Casino Info</h3>

			<ul class="row">
				<li class="col-sm-2">Payout <input type="number" v-model="payout" min="0" max="100" step="0.1"></li>
				<li class="col-sm-2">Win% <input type="number" v-model="winOdds" min="0" max="1" step="0.01"></li>
				<li class="col-sm-2">Min Bet <input type="number" v-model="minBet" min="0" max="100"></li>
			</ul>			

		<h3>Player Info</h3>
			
			<ul class="row">
				<li class="col-sm-3">Bank: {{ bank }}</li>
				<li class="col-sm-3">Bet Multi: <input type="number" v-model="betMulti" min="0" max="10.0" step="0.1"></li>
				<li class="col-sm-3">Avg Profit: {{ avgProfit }}</li>
				<li class="col-sm-3">Safe Bets: {{ safeBetCount }}</li>
				<li class="col-sm-3">Bust Odds: {{ safeBetOdds }}</li>
				<li class="col-sm-3">Bet: {{ bet.toFixed(2) }} {{ winPayout }}</li>
				<li class="col-sm-3">Investment: {{ investment }}</li>
				<li class="col-sm-3">Highest Bet: {{ highestBet }}</li>
			</ul>

		<div id="buttons">

			<input type="number" placeholder="Roll Count" v-model="rollRate">
			<button v-on:click="gameLoop">Roll {{ rollRate }}x</button>
			
		</div>
	
	</div><!-- wrapper -->
	
	<script type="text/javascript">
		
		var casino = new Vue({
			el: '#wrapper',
			data: {
				// Casino
				round: 1,
				payout: 2,
				winOdds: 0.3,
				minBet: 1,

				// Player
				bankHistory: [],
				bank: 100,
				bet: 1,
				betMulti: 1.5,
				highestBet: 1,
				investment: 0,
				rollRate: 100
			},
			computed: {
				safeBetCount() {
					var max = 0;
					while(this.bet * Math.pow(this.betMulti, max + 1) < this.bank) { max++; }
					return max;
				},
				safeBetOdds() {
					var max = 0;
					while(this.bet * Math.pow(this.betMulti, max + 1) < this.bank) { max++; }

					var odds = (Math.pow(1 - this.winOdds, max) * 100);

					return "~1/" + (100 / odds).toFixed(0) + " (" + odds.toFixed(6) + "%)";
				},
				winPayout() {
					return "(Payout: " + (this.bet * this.payout).toFixed(2) + ")";
				},
				avgProfit() {
					return ((this.bank - 100) / this.round).toFixed(2);
				}
			},
			methods: {
				win() {
					this.bank += this.bet * this.payout;
					this.bet = this.minBet;
					this.investment = 0;
					this.round++;
				},
				lose() {
					this.bank -= this.bet;
					this.bet *= this.betMulti;
					this.investment += this.bet;

					this.highestBet = Math.max(this.bet, this.highestBet).toFixed(2);
				},
				roll() {
					return Math.random();
				},
				game() {
					if (this.roll() >= this.winOdds) {
						this.lose();
						this.updateChart();

						return;			
					}

					this.win();
					this.updateChart();
				},
				gameLoop() {
					for (var i = 0; i < this.rollRate; i++) { this.game(); }

					chart.update(0);
				},
				updateChart() {
					chart.data.labels.push("Round " + this.round);
					chart.data.datasets.forEach((dataset) => dataset.data.push(this.bank));
				}
			}
		});

		var chart = new Chart(
			$("#graph")[0].getContext('2d'), 
			{
				type: 'line',
				data: {
					labels: [],
					datasets: [{
						label: "Player Bank",
						borderColor: "#4B5",
						backgroundColor: "rgba(136, 186, 153, .25)",
						data: []
					}]
				}
			}
		);

	</script>
</body>
</html>